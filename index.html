<!DOCTYPE html>
<html>
<head>
</head>
<body>

<div>dolphin.js</div>
<input id="textinput" type="text"/>
<div id="label"></div>
<button id="submitButton">Submit</button>

<button id="addButton">Add</button>
<div id="list"></div>

<script src="libs/require.js"></script>
<script src="config.js"></script>
<script>
    require([
        'Dolphin',
        'comm/ClientAttribute'
    ], function (
            Dolphin,
            ClientAttribute) {

        var serverUrl = "http://localhost:8888/myFirstDolphin/tutorial/";
        var dolphin = new Dolphin(serverUrl);

        console.log('init done', dolphin);


        var attribute = new ClientAttribute("attrId");

        dolphin.getClientDolphin().presentationModel(
                "step_7.TutorialConstants.modelId",
                undefined,
                attribute
        );

        var textinput = document.getElementById("textinput");
        var label = document.getElementById("label");
        var button = document.getElementById("submitButton");

        button.addEventListener("click", function() {
            dolphin.getClientDolphin().send("step_7.TutorialConstants.LogOnServer");
        });

        textinput.addEventListener("input", function() {
            var value = textinput.value;
            attribute.setValue(value);
        });

        attribute.on("valueChange", function(data) {
            label.innerHTML = data.newValue;
        });

        attribute.on("valueChange", function(data) {
            textinput.value = data.newValue;
        });


        var addButton = document.getElementById("addButton");
        var list = document.getElementById("list");
        addButton.addEventListener("click", function() {
            dolphin.getClientDolphin().send("step_7.TutorialConstants.add", function(models) {
                console.log("NEW models", models);
                models.forEach(function(model) {
                    var element = document.createElement("div");
                    element.innerHTML = model.presentationModelType+": "+model.attributes[0].value;
                    list.appendChild(element);
                })
            });
        });



    });
</script>

</body>
</html>