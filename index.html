<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Dolphin.js Tutorial</title>
        <script src="libs/require.js"></script>
        <script src="config.js"></script>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <style>
            body {
                padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
            }
        </style>
    </head>
    <body>
        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="brand" href="#">Dolphin.js</a>

                    <ul class="nav">
                        <li class="active"><a href="#">Step 1</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <h1>Dolphin.js Tutorial</h1>

            <form>
                <fieldset>
                    <legend>Step 1</legend>
                    <span class="help-block">Type something in the input text to test the binding with the label.</span>
                    <input id="textInput" type="text" placeholder="Type something..."/>
                    <p>Label: <span id="label"></span></p>
                    <button id="logActionButton" class="btn btn-primary">Log Action</button>
                </fieldset>
            </form>
        </div>

        <script>
            require([
                'Dolphin',
                'comm/ClientAttribute'
            ], function (Dolphin, ClientAttribute) {

                const serverUrl = "http://localhost:8080/myFirstDolphin/tutorial/";
                const pmId = "step_7.TutorialConstants.modelId";
                const attrId = "attrId";
                const actionId = "step_7.TutorialConstants.LogOnServer";

                var dolphin = new Dolphin(serverUrl);

                var attribute = new ClientAttribute(attrId);
                dolphin.getClientDolphin().presentationModel(
                        pmId,
                        undefined,
                        attribute
                );

                var textInput = document.getElementById("textInput");
                var label = document.getElementById("label");
                var logActionButton = document.getElementById("logActionButton");

                logActionButton.addEventListener("click", function () {
                    dolphin.getClientDolphin().send(actionId);
                });

                textInput.addEventListener("input", function () {
                    var value = textInput.value;
                    attribute.setValue(value);
                });

                attribute.on("valueChange", function (data) {
                    label.innerHTML = data.newValue;
                });

            });
        </script>
    </body>
</html>